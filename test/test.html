<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>


<script>

    function post(api, map_data, call_func) {

        let request = {};
        let request_text = "";
        let test_data = [api, map_data, call_func];

        // 开始-Fetch-请求数据
        // const post_api = config.api_url + "admin/login_check";
        // const map_body = new Map([ // 要提交数据
        //      ["login_token", login_token],
        // ]);

        let map = map_data;
        let body = "";
        for (let [k, v] of map) { body += k+"="+v+"&"; } // 拼装数据，限制2MB最佳
        let post_api = api;
        fetch(post_api, {
            method: "post",     // get/post
            mode: "cors",       // same-origin/no-cors/cors
            cache: "no-cache",
            headers: {
                "Content-type": "application/x-www-form-urlencoded; charset=UTF-8",
            },
            body: body,         // 格式要求：body:"key1=val1&key2=val2"
        }).then(function (response){
            if (response.status === 200){return response;}
        }).then(function (data) {
            return data.text();
        }).then(function(text){
            // 统一格式转换
            let back = null;
            let res = null;
            if (typeof text === "string"){
                back = text;
                try {
                    res = JSON.parse(text);
                }catch (e) {
                    res = text;
                }
            }else if (typeof text === "object"){
                back = JSON.stringify(text);
                res = text;
            }else {console.log("Unknown Typeof = " + typeof text); back = text;}
            // view.log("①Typeof：\n" + typeof text + "\n②Api_data：\n" + back);

            request = {
                "request_status": true,
                "request_back": res,
                "request_text": back,
            };
            request_text = back;

            call_func(request, test_data, request_text);

        }).catch(function(error){
            let error_info = "▲ Fetch遇到错误：" + error +" ▲";
            console.log("%c"+error_info, "color:red;font-weight:bold;font-size:18px;");

            request = {
                "request_status": false,
                "request_back": "",
            };
            request_text = error_info;

            call_func(request, test_data, error_info);

        });
        // 结束-Fetch

    }

</script>



<script>


    function run_res(request, test_data, text) {
        console.log([request, test_data, text]);


    }
    (function () {

        let map = new Map([
            ["app_class", "pc"],
            ["url", "http://test"],
        ]);

        let url = "//47.111.168.64/cswd/public/index.php/api/app/get_app_token";

        post(url, map, run_res);

    })();


</script>


</body>
</html>