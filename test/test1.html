<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>loading...</title>


</head>
<body class="body">

<style>



</style>

<div id="verify_box" class="select-none verify_box"></div>

<script>

    function verify_continue(data) {
        console.log("continue");
        console.log(data);
    }
    function verify_run(data) {
        console.log("run");
        console.log(data);
    }

    function make_verify(data) {
        console.log("验证不成功请调用verify_continue(data)，验证成功请调用verify_run(data)。");
        var slider_div = '<div id="verify_xbox">' +
            '<div id="slider-btn"><img class="slider_img" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAALCAAAAACFLIiAAAAAVElEQVQY0zXNEQLDQBBA0bn/DcZqoVpsbK20VssJQrXaC+wsPfjwY96gEZUTGqHy/LMJvq/jtgn8zpybACNHEzDzuJrgfmfZhLFiE5W1/rX+nws0HjfAkZxZFHpiAAAAAElFTkSuQmCC" /></div>' +
            '</div>' +
            '<div class="slider-txt">按住滑块，拖动到最右边</div>';
        var slider_style = '<style>#verify_box{width:240px;height:40px;text-align:center;line-height:40px;font-size:14px;color:#fff;position:relative;background-color:rgba(212,212,212,1);}#verify_xbox{width:54px;height:40px;text-align:center;line-height:40px;font-size:14px;color:#fff;position:absolute;background:#7BBB55;}#slider-btn{cursor:pointer;width:54px;height:38px;background-color:rgba(255,255,255,1);border:solid 1px rgba(212,212,212,1);float:right;}.continue{width:120px;height:40px;background-color:rgba(212,212,212,1);margin:0 70px;border:none;color:#302f41;font-size:16px;}.continue:hover{background-color:rgba(235,54,38,1);color:#ffffff;}.slider_img{max-width:100%;}.slider-txt{text-align:center;width:calc(100% - 56px);padding-left:56px;}.select-none{-moz-user-select: none;-webkit-user-select: none;-ms-user-select: none;user-select: none;}#slider-btn:avtive{opacity: 0.8;}</style>';

        var box=document.getElementById('verify_box');
        if (box){
            box.innerHTML = slider_div+slider_style;
            var xbox=document.getElementById('verify_xbox');
            var element=document.getElementById('slider-btn');
            var b=box.offsetWidth;
            var o=element.offsetWidth;
            element.ondragstart=function(){return false;};
            element.onselectstart=function(){return false;};
            element.onmousedown=function(e){
                var disX=e.clientX-element.offsetLeft;
                document.ontouchmove=function(e){var l=e.clientX-disX+o;if(l<o){l=o}
                    if(l>b){l=b}
                    xbox.style.width=l+'px';};
                document.onmouseup=function(e){
                    var l=e.clientX-disX+o;
                    if(l<b){
                        l=o;
                        try {
                            verify_continue(data);
                        }catch (e) {
                            console.log("验证不成功的回调函数verify_continue(data)不存在，但可忽略。");
                        }
                    }else{
                        l=b;
                        xbox.innerHTML = '验证通过！<div id="slider-btn"><img class="slider_img" style="margin-top:8px" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAALCAAAAACFLIiAAAAAVElEQVQY0zXNEQLDQBBA0bn/DcZqoVpsbK20VssJQrXaC+wsPfjwY96gEZUTGqHy/LMJvq/jtgn8zpybACNHEzDzuJrgfmfZhLFiE5W1/rX+nws0HjfAkZxZFHpiAAAAAElFTkSuQmCC" /></div>';
                        try {
                            verify_run(data);
                        }catch (e) {
                            console.log("验证成功后的回调函数verify_run(data)不存在，请注意。");
                        }
                    }
                    xbox.style.width=l+'px';
                    document.onmousemove=null;
                    document.onmouseup=null;
                };
            }
        }else {
            console.log('标签<div id="verify_box" class="select-none "></div>不存在，请提前声明或创建');
        }
    }

    (function () {

        //make_verify(1);

    })();


</script>


<script>



    /*
    * 验证码生成器
    * 先放标签
    * 直接调用make_code_verify(data)即可
    * */
    function make_code_verify(data) {
        let div = '<div class="verify-num-box"><div class="show-check" id="show-check" onclick="verify_make_num()">12+23=</div><input class="input-check" value="" id="input-check" placeholder="输入计算结果" maxlength="9" type="text" /><div class="clear"></div></div> <div class="verify-num-div"><div class="verify-btn-style verify-close" onclick="verify_cancel()">取消</div><div class="verify-btn-style verify-ok" onclick="verify_ok()">确定</div><div class="clear"></div></div>';
        let style = '<style>.verify_box{width:280px;position:relative;top:calc(50% - 60px);left:0;right:0;margin:auto;box-shadow:0 0 8px lightgray;padding:10px 10px;}.show-check{width:calc(150px - 8px);padding:0 4px;font-size:16px;line-height:32px;display:inline-block;float:left;overflow:hidden;cursor:pointer;}.show-check:active{opacity:0.8;}.input-check{width:110px;height:30px;font-size:15px;letter-spacing:2px;float:left;padding:0 4px;margin-left:8px;text-align:center;}.verify-num-box{width:100%;line-height:32px;}.verify-num-div{height:34px;padding-top:15px;}.verify-btn-style{width:80px;float:left;letter-spacing:5px;border-radius:3px;font-size:16px;text-align:center;height:32px;line-height:32px;font-weight:600;margin-left:45px;cursor:pointer;}.verify-close{background:white;box-shadow:0 0 4px lightgray;color:black;}.verify-close:active{opacity:0.8;}.verify-ok{background:#4185FF;box-shadow:0 0 4px lightgray;color:white;}.verify-ok:active{opacity:0.8;}.clear{clear:both;}.select-none{-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none;}</style>';
        var box=document.getElementById('verify_box');
        if (box){
            box.innerHTML = div+style;
            verify_data_res = data;
            verify_make_num();
        }else {
            console.log('标签<div id="verify_box" class="select-none verify_box"></div>不存在，请提前声明或创建');
        }
    }
    function _js_rand(min, max) { // [min, max]
        let this_rand = Math.floor(Math.random()*(max-min+1)+min);
        return this_rand;
    }
    let verify_num_res = 0;
    let verify_data_res = 0;
    function verify_make_num() {
        let num1= _js_rand(0, 99);
        let num2= _js_rand(1, 11);
        let num0 = _js_rand(1, 3); // 加减乘除
        let mark = "";
        switch (num0) {
            case 1:
                verify_num_res = num1-num2;
                mark = "减";
                break;
            case 2:
                verify_num_res = num1+num2;
                mark = "加";
                break;
            case 3:
                verify_num_res = num1*num2;
                mark = "乘";
                break;
            default:
                verify_num_res = num1*num2;
                mark = "乘";
                break;
        }
        let _div = num1+"&nbsp;"+mark+"&nbsp;"+num2+"&nbsp;"+"&nbsp;"+"等于";
        document.getElementById("show-check").innerHTML = _div;
    }
    function verify_cancel() {
        console.log("cancel");
        try {
            verify_close(verify_data_res);
        }catch (e) {
            console.log("关闭验证的回调函数verify_close(data)不存在，请注意。");
        }
    }
    function verify_ok() {
        let num = document.getElementById("input-check").value*1;
        console.log([num, verify_num_res]);
        if (!num || num !== verify_num_res){
            verify_make_num();
            try {
                verify_continue(verify_data_res);
            }catch (e) {
                console.log("验证不成功的回调函数verify_continue(data)不存在，但可忽略。");
            }
        }else {
            try {
                verify_run(verify_data_res);
            }catch (e) {
                console.log("验证成功后的回调函数verify_run(data)不存在，请注意。");
            }
        }
    }



    (function () {
        make_code_verify(1);
    })();

</script>


</body>
</html>