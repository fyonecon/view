var tare = document.getElementById('tare'); var warning = document.getElementById('warning'); var currentTouchF; function transformTare() { if (typeof currentTouchF == 'undefined') return; tare.style.webkitTransform = 'rotateX(' + currentTouchF.force * 60 + 'deg)' } setInterval(transformTare, 10); function tareTouchStart(e) { e.preventDefault(); currentTouchF = e.touches[0]; tareForce = e.touches[0].force } tare.addEventListener('touchstart', tareTouchStart, false); var weight = document.getElementById('weight'); var forceConversions = [0.8, 1, 1.2]; var fcIndex = 1; var tare = document.getElementById('tare'); var circle2 = document.getElementById('circle2'); var maxForce = 6.666666667; var tareForce = 0; var currentTouch; var updater = 0; var numTouches = 0; var touches = {}; var force = 0; document.getElementById('sense').onchange = function(e) { fcIndex = this.selectedIndex; document.cookie = "fc=" + fcIndex; }; var fcCookie = ('; ' + document.cookie).split('; fc=').pop().split(';').shift(); fcIndex = fcCookie == "" ? fcIndex : +fcCookie; document.getElementById('sense').selectedIndex = fcIndex; function onForceStart(event) { currentTouch = event.touches[0]; numTouches = event.touches.length } function onForceMove(event) { event.preventDefault(); currentTouch = event.touches[0]; numTouches = event.touches.length } function onForceEnded(event) { event.preventDefault(); setTimeout(function() { currentTouch = undefined; force = 0; delete touches[event.changedTouches[0].identifier]; }, 2); numTouches = event.touches.length } function onForceChange(event) { event.preventDefault(); currentTouch = event.changedTouches[0]; force = 0; for (var i = 0; i< event.changedTouches.length; i++) touches[event.changedTouches[i].identifier] = event.changedTouches[i].force; numTouches = Object.keys(touches).length; for (var k in touches) if (touches.hasOwnProperty(k)) { force += touches[k] } } function weigh(force) { var tare = force - tareForce; var grams = (tare * 405.257 * forceConversions[fcIndex] + 2.056 * forceConversions[fcIndex]); if (grams< 12) grams -= 2.056 * forceConversions[fcIndex]; return grams.toFixed(2); }; function updateForce() { if (numTouches > 1) { warning.style.display = 'inline-block'; } else { warning.style.display = 'none'; } circle2.style.height = ((force / numTouches) * 345) + 'px'; circle2.style.width = ((force / numTouches) * 345) + 'px'; document.getElementById('container').style.webkitTransform = 'rotateX(' + force / numTouches * -20 + 'deg) scale(' + (1 - (force / numTouches * 0.06)) + ')'; var px = force / numTouches * 5 + 'px'; if (force > 0) document.body.style.boxShadow = '0px 0px ' + ' 15px ' + px + ' rgba(0, 0, 0, 0.333) inset'; weight.innerHTML = weigh(force) + 'g'; } setInterval(updateForce, 1); var circle = document.getElementById('circle'); circle.addEventListener('touchmove', onForceMove, false); circle.addEventListener('touchstart', onForceStart, false); circle.addEventListener('touchend', onForceEnded, false); circle.addEventListener('touchforcechange', onForceChange, false);


function start_this_page(e) {
    view.log(e);
}
